---
#{{{
# vim: set conceallevel=0:
title: 'Χρήση Οθόνης  2×16 Χαρακτήρων στον AVR'
subtitle: 'Εργαστήριο Μικροϋπολογιστών'
author:
- Κριθαρίδης Κωνσταντίνος, $el21045$
- Μπαλάτος Δημήτριος, $el21170$
date: '7 Νοεμβρίου 2024'
subject: ''
keywords: ''
abstract: ''
lang: el_GR
linkcolor: blue
fontsize: 12pt
#fontfamily: 'GFS Artemisia'
mainfont: 'CMU Serif'
sansfont: 'CMU Sans Serif:style=BoldItalic'
monofont: 'CMU Typewriter Text:style=LightOblique'
documentclass: article
classoption: ''
toc: false
papersize: a4
geometry:
- margin=1.5cm
urlcolor: blue
toccolor: black
links-as-notes: false
numbersections: true
#}}}
---

# Ζήτημα 4.1


# Ζήτημα 4.2
Στην άσκηση αυτή, αρχικά, μετατρέπουμε τον δοσμένο κώδικα Assembly για τον χειρισμό της οθόνης σε C. Για να τυπώνουμε αριθμούς προσθέτουμε συναρτήσεις `lcd_digit` και `lcd_number` που τυπώνουν 1 δεκαδικό ψηφίο και 1 $32\rm-bit$ μη προσημασμένο δεκαδικό αριθμό αντίστοιχα. Στον κύριο κώδικα αρχικοποιήσουμε το `PORTD` ως έξοδο, την οθόνη, και τον ADC με $V_{REF} = 5V$, είσοδο `ADC1`, δεξιά στοιχισμένη, χωρίς διακοπές και με συχνότητα $125\rm kHz$. Στη συνέχεια, διαβάζουμε διαρκώς την έξοδο του ADC και μόλις τελειώνει η μετατροπή εμφανίζουμε κάθε φορά την τιμή $\frac{ADC}{1024} V_{REF}$ με ακρίβεια 2 δεκαδικών στην οθόνη.

```asm {source=Ex4_2/Ex4_2/main.c}
```

# Ζήτημα 4.3
Κρατάμε τον κώδικα C για τον χειρισμό της οθόνης και την αρχικοποίηση της εξόδου (αυτή τη φορά `PORTD` και `PORTB`), της οθόνης και του ADC (αυτή τη φορά με είσοδο το `ADC2`). Αρχικοποιούμε επιπλέον τον μετρητή `Timer1` σε λειτουργία CTC για να μετράει 100ms και να κάνει διακοπή κάθε φορά που αυτά περνάνε. Για να μην ξοδεύουμε πολύ χρόνο μέσα στη ρουτίνα εξυπηρέτησης της διακοπής, κατά τις διακοπές αλλάζουμε τιμή σε μια boolean σημαία που υποδεικνύει ότι έγινε διακοπή από τον μετρητή. Στον κύριο κώδικα, ελέγχουμε αν αυτή η σημαία είναι σηκωμένη, και, αν ναι, αφού τη χαμηλώσουμε, διαβάζουμε την τιμή του ADC και υπολογίζουμε την τάση $V_{gas} = \frac{ADC}{1024} V_{REF}$. Στη συνέχεια, υπολογίζουμε τα ppm μέσω της συνάρτησης `calc_ppm` και, ανάλογα με την τιμή του ψηφίου των εκατοντάδων των ppm ανάβουμε το αντίστοιχο LED του `PORTB`. Αν ανινχνεύονται πάνω από $70\rm ppm$ εμφανίζουμε στην οθόνη το μήνυμα `"GAS DETECTED"` και αναβοσβήνουμε το αναμμένο LED του `PORTB`, ενώ αλλιώς εμφανίζουμε στην οθόνη `"CLEAR"` και το αντίστοιχο αναμμένο LED του `PORTB` παραμένει στάσιμο.

```asm {source=Ex4_3/Ex4_3/main.c}
```