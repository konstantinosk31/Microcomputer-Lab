---
#{{{
# vim: set conceallevel=0:
title: 'Χρήση εξωτερικών Θυρών Επέκτασης στον AVR'
subtitle: 'Εργαστήριο Μικροϋπολογιστών'
author:
- Κριθαρίδης Κωνσταντίνος, $el21045$
- Μπαλάτος Δημήτριος, $el21170$
date: '12 Νοεμβρίου 2024'
subject: ''
keywords: ''
abstract: ''
lang: el_GR
linkcolor: blue
fontsize: 12pt
#fontfamily: 'GFS Artemisia'
mainfont: 'CMU Serif'
sansfont: 'CMU Sans Serif:style=BoldItalic'
monofont: 'CMU Typewriter Text:style=LightOblique'
documentclass: article
classoption: ''
toc: false
papersize: a4
geometry:
- margin=1.5cm
urlcolor: blue
toccolor: black
links-as-notes: false
numbersections: true
#}}}
---

# Ζήτημα 5.1
Αρχικά, μεταφέρουμε τον κώδικα της εκφώνησης για την επικοινωνία με το PCA9555 
μέσω της διεπαφής TWI. Στην συνάρτηση main, αφού αρχικοποιήσουμε το TWI, και 
θέσουμε το `EXT_PORT0` ως έξοδο μέσω του καταχωρητή `REG_CONFIGURATION_0` και το 
PORTB ως input, ξεκινάμε να διαβάζουμε διαρκώς το PINB (το οποίο μετατρέπουμε σε 
θετική λογική). Αποθηκεύουμε σε διαφορετικές μεταβλητές τα $A,\ B,\ C,\ D$ και 
υπολογίζουμε τα $F0,\ F1$ με βάση αυτές. Τέλος, γράφουμε στο `EXT_PORT0` μέσω 
του καταχωρητή `REG_OUTPUT_0` τις τιμές των $F0,\ F1$. Αφού έχουμε συνδέσει τους 
ακροδέκτες `IO0_0` και `IO0_1` του κονέκτορα `P18` με τους ακροδέκτες `LED_PD2` 
και `LED_PD3`, βλέπουμε το αποτέλεσμα που γράφουμε στο `EXT_PORT0` στα 
αντίστοιχα LEDs. 

```c {source=Ex5_1/Ex5_1/main.c}
```

# Ζήτημα 5.2
Μεταφέρουμε τον κώδικα της εκφώνησης για την επικοινωνία με το PCA9555, όπως και 
παραπάνω. Για την χρήση του numpad, στέλνουμε High Voltage στα pins που 
αντιστοιχούν στις πάνω 3 γραμμές και Low Voltage στην γραμμή που θέλουμε να 
ενεργοποιήσουμε. Στην συνέχεια διαβάζουμε συνεχώς το `IO1` και κρατάμε τα bits 
που αντιστοιχούν στις στήλες· με έναν βρόχο βρίσκουμε ποια στήλη είναι πατημένη 
(Low Voltage) και ενημερώνουμε αντίστοιχα τα LEDs του `J18`. Σημ.: για 
απλοποίηση του κώδικα χρησιμοποιήσαμε την συμπληρωματική ως προς 1 τιμή του 
`REG_INPUT_1`.

```c {source=Ex5_2/Ex5_2/main.c}
```

# Ζήτημα 5.3
Μεταφέρουμε τον κώδικα, όπως και παραπάνω, καθώς και τον κώδικα επικοινωνίας με 
την LCD σε C από την σειρά 4. Αλλάζουμε τις εγγραφές στο `PORTD` με συναρτήσης 
PCA9555, ενώ για να γλιτώσουμε μερικά reads ορίζουμε global μεταβλητή `LAST` που 
ενημερώνουμε κατά τις εγγραφές. Για διευκόλυνση, ορίζουμε συνάρτηση `flash()` 
που τρέχει συχνά επαναλαμβανόμενές εντολές κατά την χρήση της LCD, καθώς και 
`lcd_string(str)` για την εκτύπωση c string στην οθόνη (σε περίπτωση επιλογής 
`'\n'`{.c}, τοποθετούμε τον κέρσορα στην πρώτη στήλη της δεύτερης γραμμής).

```c {source=Ex5_3/Ex5_3/main.c}
```
